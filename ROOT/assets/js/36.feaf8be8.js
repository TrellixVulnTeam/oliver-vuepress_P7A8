(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{536:function(t,s,a){"use strict";a.r(s);var n=a(9),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"什么是orm？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是orm？"}},[t._v("#")]),t._v(" 什么是ORM？")]),t._v(" "),a("p",[t._v("ORM 全称 Object Relation Mapping: 对象 - 关系映射 的缩写\nORM主要是完成面向对象的编程语言到关系型数据库的映射")]),t._v(" "),a("h2",{attrs:{id:"mybatis-是什么？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-是什么？"}},[t._v("#")]),t._v(" Mybatis 是什么？")]),t._v(" "),a("p",[t._v("Mybatis 是基于 ORM 的 半自动的持久层框架。")]),t._v(" "),a("ul",[a("li",[t._v("优点：\n"),a("ul",[a("li",[t._v("不需要去处理JDBC的连接、手动设置参数、以及获取结果集")]),t._v(" "),a("li",[t._v("开发  只要关注 核心的 SQL 语句，sql 和 java编码分开，功能边界清洗")]),t._v(" "),a("li",[t._v("可以使用 XML 和 注解的方式使用")]),t._v(" "),a("li",[t._v("XML 支持 动态标签 SQL")])])]),t._v(" "),a("li",[t._v("缺点：\n"),a("ul",[a("li",[t._v("SQL语句依赖于数据库，导致数据库移植性差")])])])]),t._v(" "),a("h2",{attrs:{id:"和-的区别是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#和-的区别是什么"}},[t._v("#")]),t._v(" "),a("code",[t._v("#{}")]),t._v("和 "),a("code",[t._v("${}")]),t._v(" 的区别是什么")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("#{}")]),t._v(" :  是预编译处理\n"),a("ul",[a("li",[t._v("Mybatis 处理时，会将sql 中  "),a("code",[t._v("#{}")]),t._v("  替换 成 "),a("code",[t._v("?")]),t._v(" ,  调用 preparedStatement 的 "),a("code",[t._v("set")]),t._v(" 方法进行赋值")]),t._v(" "),a("li",[t._v("可以有效的防止 SQL 注入 ::sdasda::")])])]),t._v(" "),a("li",[a("code",[t._v("${}")]),t._v(":  是字符串替换\n"),a("ul",[a("li",[t._v("Mybatis执行时，直接将字符串替换，没有预编译处")])])])]),t._v(" "),a("h2",{attrs:{id:"如何获取⾃动⽣成的-主-键值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何获取⾃动⽣成的-主-键值"}},[t._v("#")]),t._v(" 如何获取⾃动⽣成的(主)键值?")]),t._v(" "),a("p",[t._v("方法1： 使用 useGeneratedKeys + keyProperty 属性\n方法2：通过LAST_INSERT_ID()获取刚插⼊记录的⾃增主键值，在insert语句执⾏后，执⾏select （"),a("code",[t._v("<selectKey />")]),t._v("）LAST_INSERT_ID()就可以获取⾃增主键")]),t._v(" "),a("h2",{attrs:{id:"在mapper中如何传递多个参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在mapper中如何传递多个参数"}},[t._v("#")]),t._v(" 在mapper中如何传递多个参数?")]),t._v(" "),a("ul",[a("li",[t._v("在映射⽂件中使⽤"),a("code",[t._v("#{0}")]),t._v(", "),a("code",[t._v("#{1}")]),t._v(" 代表传递进来的第⼏个参数")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> #{0}: 代表第一个传入的参数   #{1}: 代表第二个传入的参数\n<select id="selectUser"resultMap="BaseResultMap">\nselect * fromuser_user_t whereuser_name = #{0} anduser_area=#{1} \n</select>\n')])])]),a("ul",[a("li",[t._v("使⽤@param注解:来命名参数")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("## Dao 层 使用 param 指定变量名\n\npublic interface userMapper {\nuser selectuser(@param(“username”) string username,\n@param(“hashedpassword”) string hashedpassword);\n}\n\n## XML 层\n<select id=”selectuser” resulttype=”user”>\nselect id, username, hashedpassword\nfrom some_table\nwhere username = #{username}\nand hashedpassword = #{hashedpassword}\n</select>\n\n")])])]),a("ul",[a("li",[t._v("使用 Map 集合作为参数来装载")])]),t._v(" "),a("h2",{attrs:{id:"mybatis动态sql是做什么的？都有哪些动态sql？能简单简单阐述一下动态sql的执行原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis动态sql是做什么的？都有哪些动态sql？能简单简单阐述一下动态sql的执行原理"}},[t._v("#")]),t._v(" Mybatis动态sql是做什么的？都有哪些动态sql？能简单简单阐述一下动态sql的执行原理")]),t._v(" "),a("ul",[a("li",[t._v("Mybatis动态sql可以让我们在Xml映射⽂件内，以标签的形式编写动态sql，完成逻辑判断和动态\n拼接sql的功能。")]),t._v(" "),a("li",[t._v("Mybatis提供了9种动态sql标签：trim|where|set|foreach|if|choose|when|otherwise|bind。")]),t._v(" "),a("li",[t._v("其执⾏原理为，使⽤OGNL从sql参数对象中计算表达式的值，根据表达式的值动态拼接sql，以此来完成动态sql的功能。")])]),t._v(" "),a("h2",{attrs:{id:"mybatis的xml映射⽂件中，不同的xml映射⽂件，id-是否可以重复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis的xml映射⽂件中，不同的xml映射⽂件，id-是否可以重复"}},[t._v("#")]),t._v(" Mybatis的Xml映射⽂件中，不同的Xml映射⽂件，id 是否可以重复")]),t._v(" "),a("p",[t._v("在 同一个Xml 映射文件是不可以重复的，因为我们与Mapper 映射时，使用： "),a("code",[t._v("namespace+id")]),t._v(" 做关联的，并存放在 一个 "),a("code",[t._v("hashMap")]),t._v(" 中，所以同一个文件时，导致会对应错误，因为映射关系会被覆盖")]),t._v(" "),a("p",[t._v("但是在不同的xml隐映射文件 中 id相同，是可以重复的")]),t._v(" "),a("h2",{attrs:{id:"mybatis-架构层级-和-基本的执行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-架构层级-和-基本的执行流程"}},[t._v("#")]),t._v(" MyBatis 架构层级 和 基本的执行流程")]),t._v(" "),a("p",[t._v("MyBatis分为 三层：")]),t._v(" "),a("ul",[a("li",[t._v("API 接口层：\n"),a("ul",[a("li",[t._v("提供的给外部使用的接口API层, 使用API层来操作数据库")]),t._v(" "),a("li",[t._v("MyBatis  与 数据库的交互方式\n"),a("ul",[a("li",[t._v("传统的 MyBatis 提供的API")]),t._v(" "),a("li",[t._v("使用 Mapper代理方式")])])])])]),t._v(" "),a("li",[t._v("数据处理层\n"),a("ul",[a("li",[t._v("参数映射 (ParameterHandler)")]),t._v(" "),a("li",[t._v("SQL解析 (SqlSource)")]),t._v(" "),a("li",[t._v("SQL执行 (Executor)")]),t._v(" "),a("li",[t._v("结果处理 和 映射 (ResultSetHandler)")])])]),t._v(" "),a("li",[t._v("基础支持层\n"),a("ul",[a("li",[t._v("连接管理")]),t._v(" "),a("li",[t._v("事务管理")]),t._v(" "),a("li",[t._v("配置加载")]),t._v(" "),a("li",[t._v("缓存处理")])])])]),t._v(" "),a("h3",{attrs:{id:"总体执行流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总体执行流程"}},[t._v("#")]),t._v(" 总体执行流程")]),t._v(" "),a("ul",[a("li",[t._v("加载配置文件并初始化")]),t._v(" "),a("li",[t._v("接收调用请求")]),t._v(" "),a("li",[t._v("处理操作请求")]),t._v(" "),a("li",[t._v("返回处理结果")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/java/other/mybatis/mybatis-1.jpg"),alt:"foo"}}),t._v(" "),a("p",[t._v("处理过程：")]),t._v(" "),a("ol",[a("li",[t._v("根据 SQL 的 ID查找对应的 MappedStatment对象")]),t._v(" "),a("li",[t._v("根据传入参数对象解析 MappedStatmentd对象，得到最终要执行的 SQL 和 执行传入参数")]),t._v(" "),a("li",[t._v("获取数据库连接，并执行数据库操作，并得到结果")]),t._v(" "),a("li",[t._v("根据 MapperdStatement对象的结果映射配置，对返回结果进行转换处理，并得到最终的处理结果")]),t._v(" "),a("li",[t._v("释放连接资源")]),t._v(" "),a("li",[t._v("返回处理结果")])]),t._v(" "),a("h2",{attrs:{id:"mybatis-缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-缓存"}},[t._v("#")]),t._v(" MyBatis 缓存")]),t._v(" "),a("blockquote",[a("p",[t._v("Mybatis 提供了对象缓存的支持，分为一级缓存 和二级缓存")])]),t._v(" "),a("p",[t._v("相关概念点：")]),t._v(" "),a("h3",{attrs:{id:"一级缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一级缓存"}},[t._v("#")]),t._v(" 一级缓存")]),t._v(" "),a("blockquote",[a("p",[t._v("一级缓存："),a("code",[t._v("SqlSession")]),t._v("  级别的缓存。在操作数据库时需要构造 "),a("code",[t._v("SqlSession")]),t._v("  对象，在对象中有一个数据结构（HashMap）用于存储缓存数据。不同的 "),a("code",[t._v("SqlSession")]),t._v("   之间的缓存数据区域（HashMap）不影响。"),a("br"),t._v("\n一级缓存具体返回的是：缓存的对象")])]),t._v(" "),a("h4",{attrs:{id:"一级缓存的底层数据结构："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一级缓存的底层数据结构："}},[t._v("#")]),t._v(" 一级缓存的底层数据结构：")]),t._v(" "),a("blockquote",[a("p",[t._v("底层使用 "),a("code",[t._v("HashMap")]),t._v(" 来存储 一级缓存")])]),t._v(" "),a("p",[t._v("HashMap 存储的 "),a("code",[t._v("cacheKey")]),t._v("   和 "),a("code",[t._v("value")]),t._v(" :")]),t._v(" "),a("ul",[a("li",[t._v("cacheKey :\n"),a("ul",[a("li",[t._v("statementid (namespace 和 方法名 )")]),t._v(" "),a("li",[t._v("params （参数）")]),t._v(" "),a("li",[t._v("boundSql （mybatis的底层对象，对象中封装这执行的sql对象）")]),t._v(" "),a("li",[t._v("rowBounds （mybatis分页对象）")])])]),t._v(" "),a("li",[t._v("value :\n"),a("ul",[a("li",[t._v("即查询出的结果")])])])]),t._v(" "),a("p",[t._v("::注：通过SqlCache中的clearCache 找到其底层存储的结果::")]),t._v(" "),a("p",[t._v("clearCache 的调用链路：")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/java/other/mybatis/mybatis-2.jpg"),alt:"foo"}}),t._v(" "),a("h4",{attrs:{id:"一级缓存是什么时候被创建的-和-一级缓存的执行流程："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一级缓存是什么时候被创建的-和-一级缓存的执行流程："}},[t._v("#")]),t._v(" 一级缓存是什么时候被创建的 和 一级缓存的执行流程：")]),t._v(" "),a("p",[t._v("一级缓存是在执行query 查询时 被创建的：")]),t._v(" "),a("ul",[a("li",[t._v("执行查询时，先会调用  "),a("code",[t._v("createCacheKey")]),t._v("  方法获取 cacheKey\n"),a("ul",[a("li",[t._v("具体实现 在BaseExecutor sql执行器中创建的")])])]),t._v(" "),a("li",[t._v("优先去一级缓存中去查询，直接返回，无：查询数据库，同时将查询出来的结果存到一级缓存中")]),t._v(" "),a("li",[t._v("返回具体数据")])]),t._v(" "),a("h4",{attrs:{id:"一级缓存被清除的时机有那些："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一级缓存被清除的时机有那些："}},[t._v("#")]),t._v(" 一级缓存被清除的时机有那些：")]),t._v(" "),a("ul",[a("li",[t._v("做增删改操作，并进行了事务，就会刷新一级缓存")]),t._v(" "),a("li",[t._v("sqlSeesion.clearCache(): 手动刷新一级缓存")]),t._v(" "),a("li",[t._v("sqlSeesion 被 "),a("code",[t._v("close")]),t._v("  时候")])]),t._v(" "),a("h3",{attrs:{id:"二级缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二级缓存"}},[t._v("#")]),t._v(" 二级缓存")]),t._v(" "),a("blockquote",[a("p",[t._v("二级缓存：是mapper(namespace)级别的缓存 即：mapper映射层，多个 "),a("code",[t._v("SqlSession")]),t._v(" 去操作同一个Mapper的sql语句，多个SqlSession可以共用二级缓存，二级缓存是跨 "),a("code",[t._v("SqlSession")]),t._v(" 的，默认是不开启的"),a("br"),t._v("\n二级缓考 ：它返回时 会将数据重新创建一个对象之后返回 , 而不是直接返回一个对象"),a("br"),t._v("\n二级缓存的基本原理 和 一级缓存基本一致")])]),t._v(" "),a("p",[t._v("::注意事项::")]),t._v(" "),a("p",[t._v("开启后二级缓存后，所有的mybaits 的pojo 都需要继承 Serializabl序列化接口\n因为二级缓存可能存在 内存 或者硬盘 等地方 ，需要进行 序列化 和 反序列化")]),t._v(" "),a("h4",{attrs:{id:"二级缓存的开启方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二级缓存的开启方式"}},[t._v("#")]),t._v(" 二级缓存的开启方式")]),t._v(" "),a("ol",[a("li",[t._v("XML 形式\nsqlMapConfig.xml 配置文件")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<settings>\n    <setting name=“cacheEnable” value=“true”/>\n</settings>\n")])])]),a("p",[t._v("mapper.xml 文件")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<cache></cache>\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("注解形式\n在Mapper 类上 添加 "),a("code",[t._v("@CacheNamesapce")]),t._v(" 注解")])]),t._v(" "),a("h4",{attrs:{id:"二级缓存的实现分布式缓存的方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二级缓存的实现分布式缓存的方式"}},[t._v("#")]),t._v(" 二级缓存的实现分布式缓存的方式")]),t._v(" "),a("blockquote",[a("p",[t._v("自带的二级缓存 无法用于分布式缓存 因为不同不服务器内存 不通用，所以需要使用不同的第三方缓存组件来实现、redis、memcached 、ehcahce")])]),t._v(" "),a("p",[t._v("通过注解来指定使用缓存类 "),a("code",[t._v("@CacheNamesapce(implements:PerpetualCache.class)")])]),t._v(" "),a("h2",{attrs:{id:"mybatis的插件运行原理，以及如何编写一个插件？"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis的插件运行原理，以及如何编写一个插件？"}},[t._v("#")]),t._v(" Mybatis的插件运行原理，以及如何编写一个插件？")]),t._v(" "),a("blockquote",[a("p",[t._v("对 mybatis 来说插件就是拦截器，用来增强核心对象的功能，增强功能本质是借助于底层的动态代理实现的，换句话说 mybatis中的四大对象都是代理对象"),a("br"),t._v("\nMybatis 四大核心组件 "),a("code",[t._v("Executor")]),t._v("、"),a("code",[t._v("StatementHandler")]),t._v("、"),a("code",[t._v("ParameterHandler")]),t._v("、"),a("code",[t._v("ResultSetHandler")])])]),t._v(" "),a("h3",{attrs:{id:"运行原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行原理"}},[t._v("#")]),t._v(" 运行原理")]),t._v(" "),a("ol",[a("li",[t._v("每个创建出来的对象不是直接返回的，而是interceptorChain.pluginAll(parameterHandler)；")]),t._v(" "),a("li",[t._v("获取到所有的Interceptor(拦截器)（插件需要实现的接口）；调用interceptor.plugin(target);返回target包装后的对象")]),t._v(" "),a("li",[t._v("插件机制，我们可以使用插件为目标对象创建一个代理对象；aop（面向切面）我们的插件可以以为四大对象创建出代理对象，代理对象就可以拦截到四大对象的每一个执行；")])]),t._v(" "),a("h3",{attrs:{id:"如何编写一个插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何编写一个插件"}},[t._v("#")]),t._v(" 如何编写一个插件")]),t._v(" "),a("ul",[a("li",[t._v("我们需要实现 实现MyBatis的Interceptor  (拦截器)接⼝并复写intercept()⽅法\n"),a("ul",[a("li",[t._v("intercept() :  插件核心方法")]),t._v(" "),a("li",[t._v("plugin(): 生成target的代理对象")]),t._v(" "),a("li",[t._v("setProperties(): 传递插件所需要的参数")])])]),t._v(" "),a("li",[t._v("需要给插件使用注解 "),a("code",[t._v("@Intercepts")]),t._v("  、"),a("code",[t._v("@Signature")]),t._v(" ，指定相关参数\n"),a("ul",[a("li",[t._v("type: 需要拦截的类")]),t._v(" "),a("li",[t._v("method:  需要拦截的方法")]),t._v(" "),a("li",[t._v("args:  方法入参")])])]),t._v(" "),a("li",[t._v("在配置⽂件中配置你编写的插件 "),a("code",[t._v("sqlMapConfig.xml")])])]),t._v(" "),a("h2",{attrs:{id:"mybatis是如何进⾏分⻚的？分⻚插件的原理是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis是如何进⾏分⻚的？分⻚插件的原理是什么"}},[t._v("#")]),t._v(" Mybatis是如何进⾏分⻚的？分⻚插件的原理是什么")]),t._v(" "),a("ul",[a("li",[t._v("Mybatis使⽤RowBounds对象进⾏分⻚，它是针对ResultSet结果集执⾏的内存分⻚，")]),t._v(" "),a("li",[t._v("如果需要物理分页的话\n"),a("ul",[a("li",[t._v("在sql内直接书写带有物理分⻚的参数来完成物理分⻚功能")]),t._v(" "),a("li",[t._v("使用分页插件来实现物理分页")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("分页插件 同前的插件解释的一样：使⽤JDK的动态代理，为需要拦截的接⼝⽣成代理对象以实现接⼝⽅法拦截功能，（具体可以查看插件相关知识）")])]),t._v(" "),a("h2",{attrs:{id:"mybatis是否⽀持延迟加载？如果⽀持，它的实现原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis是否⽀持延迟加载？如果⽀持，它的实现原理"}},[t._v("#")]),t._v(" Mybatis是否⽀持延迟加载？如果⽀持，它的实现原理")]),t._v(" "),a("blockquote",[a("p",[t._v("延迟加载：即需要用到数据的时候才进行加载，不需要的时候不进行加载，延迟加载，也叫懒加载")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/java/other/mybatis/mybatis-3.jpg"),alt:"foo"}}),t._v(" "),a("p",[t._v("::注：:: MyBatis 使用 "),a("code",[t._v("CGLIB")]),t._v(" 或 "),a("code",[t._v("javassist")]),t._v("（默认）创建目标对象的代理对象")]),t._v(" "),a("p",[t._v("Mybatis  是 支持延时加载的")]),t._v(" "),a("ul",[a("li",[t._v("可以配置文件中配置： lazyLoadingEnabled ： true 进行全局开启")]),t._v(" "),a("li",[t._v("也可以 "),a("code",[t._v("<collection>")]),t._v(" 标签中 使用 "),a("code",[t._v('fetchType="lazy')]),t._v(" 属性 进行局部开启")])]),t._v(" "),a("h3",{attrs:{id:"原理："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理："}},[t._v("#")]),t._v(" 原理：")]),t._v(" "),a("ul",[a("li",[t._v("Mysql 开启 延时加载后")]),t._v(" "),a("li",[t._v("MyBatis 返回查询结构对象时，会对ResultMap 中的属性进行判断， 是否有 "),a("code",[t._v("Lazy")]),t._v(" 属性 ，有则会使用 "),a("code",[t._v("CGLIB")]),t._v(" 或 "),a("code",[t._v("javassist")]),t._v("（默认）创建目标对象的代理对象")]),t._v(" "),a("li",[t._v("当调用目标方法时，会进入拦截器 调用 "),a("code",[t._v("invoke()")]),t._v(" 方法")]),t._v(" "),a("li",[t._v("会判断 你当前获取的属性，是不是延时加载属性，如果是，那么就会单独发送事先保存好的查询关联B对象的sql，进行延时加载")])]),t._v(" "),a("h3",{attrs:{id:"详细源码："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#详细源码："}},[t._v("#")]),t._v(" 详细源码：")]),t._v(" "),a("ol",[a("li",[t._v("DefaultResultSetHandler.class")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建结构对象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createResultObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResultSetWrapper")]),t._v(" rsw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResultMap")]),t._v(" resultMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResultLoaderMap")]),t._v(" lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" columnPrefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SQLException")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("useConstructorMappings "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// reset previous mapping result")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" constructorArgTypes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" constructorArgs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建返回的结果映射的真实对象")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" resultObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createResultObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" resultMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columnPrefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resultObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasTypeHandlerForResultObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rsw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" resultMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResultMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" propertyMappings "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resultMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPropertyResultMappings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ResultMapping")]),t._v(" propertyMapping "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" propertyMappings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// issue gcode #109 && issue #149")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断属性有没配置嵌套查询，如果有就创建代理对象 (resultMap 中的属性)")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propertyMapping"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getNestedQueryId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" propertyMapping"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isLazy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        resultObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" configuration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getProxyFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createProxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resultObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configuration"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" objectFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("useConstructorMappings "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resultObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("constructorArgTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// set current mapping result")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resultObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("JavassistProxyFactory.class  内部类 EnhancedResultObjectProxyImpl")])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" enhanced"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" methodProxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" methodName "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("WRITE_REPLACE_METHOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methodName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" original"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constructorArgTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isEmpty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            original "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" objectFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            original "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" objectFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PropertyCopier")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("copyBeanProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" enhanced"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" original"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavassistSerialStateHolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("original"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getProperties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" objectFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" constructorArgs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" original"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//延迟加载数量⼤于0")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("FINALIZE_METHOD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("equals")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methodName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ⼀次加载性所有需要要延迟加载属性或者包含触发延迟加载⽅法")]),t._v("\n\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("aggressive "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" lazyLoadTriggerMethods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methodName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadAll")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断是否为set⽅法，set⽅法不需要延迟加载")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PropertyNamer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSetter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methodName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" property "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PropertyNamer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("methodToProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methodName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n              lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("property"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//判断是否为get⽅法，get的属性是不是个需要延时加载的属性")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PropertyNamer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isGetter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methodName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" property "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PropertyNamer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("methodToProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("methodName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//延迟加载单个属性")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasLoader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("property"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                lazyLoader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("property"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" methodProxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("invoke")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("enhanced"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExceptionUtil")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unwrapThrowable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("blockquote",[a("p",[t._v("总结来说：就是 代理对象，调用延时加载属性的 方法时，就会进入拦截器方法的 invoke() 方法，判断属性是否是个延时加载属性，如果时则执行对应的sql，进行返回结果")])]),t._v(" "),a("h2",{attrs:{id:"mybatis都有哪些executor执⾏器？它们之间的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis都有哪些executor执⾏器？它们之间的区别"}},[t._v("#")]),t._v(" Mybatis都有哪些Executor执⾏器？它们之间的区别")]),t._v(" "),a("p",[t._v("Executor：执行器是一个接口，他有三个常用的实现类：")]),t._v(" "),a("ul",[a("li",[t._v("SimpleExecutor: 普通的执行器\n"),a("ul",[a("li",[t._v("SimpleExecutor是执行器的默认实现，主要完成了“执行”功能，在利用StatementHandler 完成。每次调用执行方法 都会构建一个StatementHandler，并预设参数")]),t._v(" "),a("li",[t._v("即：每执⾏⼀次update或select，就开启⼀个Statement对象，⽤完⽴刻关闭Statement对象。")])])])]),t._v(" "),a("ul",[a("li",[t._v("ReuseExecutor: 可重用执行器\n"),a("ul",[a("li",[t._v("可重复使用JDBC中Statement，减少预编译次数。该执行器在执行SQL时会把Statement缓存起来，如果下次碰到相同的SQL，就会取出来使用。")])])])]),t._v(" "),a("ul",[a("li",[t._v("BatchExecutor: 批量操作的执行器\n"),a("ul",[a("li",[t._v("每次的执行操作 不会立即执行，而是把对应的Statement 填充好参数之后暂存起来。当调用 flushStatements 的时候一次性提交到数据库。它可用于批处理插入的场景。效果等同于SQL语句的拼装。")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("三个实现类，还有一个父类："),a("code",[t._v("BaseExecutor")])])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/java/other/mybatis/mybatis-4.jpg"),alt:"foo"}}),t._v(" "),a("h2",{attrs:{id:"mybatis-的-dao接口的工作原理？dao接口里的方法是否支持重载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-的-dao接口的工作原理？dao接口里的方法是否支持重载"}},[t._v("#")]),t._v(" Mybatis 的 Dao接口的工作原理？Dao接口里的方法是否支持重载?")]),t._v(" "),a("ul",[a("li",[t._v("Dao接⼝，就是⼈们常说的Mapper接⼝，接⼝的全限名，就是映射xml⽂件中的namespace的值， 接⼝的⽅法名，就是映射⽂件中MappedStatement的id值，接⼝⽅法内的参数，就是传递给sql的参数。")]),t._v(" "),a("li",[t._v("Mapper接⼝是没有实现类的，当调⽤接⼝⽅法时，接⼝全限名+⽅法名拼接字符串作为key值，可唯⼀定位⼀个MappedStatement")])]),t._v(" "),a("blockquote",[a("p",[t._v("Dao接⼝的⼯作原理是JDK动态代理，Mybatis运⾏时会使⽤JDK动态代理为Dao接⼝⽣成代理proxy对象，代理对象proxy会拦截接⼝⽅法，从⽽执⾏MappedStatement所代表的sql，然后将sql执⾏结果返回。")])]),t._v(" "),a("h3",{attrs:{id:"dao接口里的方法是否支持重载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dao接口里的方法是否支持重载"}},[t._v("#")]),t._v(" Dao接口里的方法是否支持重载?")]),t._v(" "),a("blockquote",[a("p",[t._v("Dao接⼝⾥的⽅法，是不能重载的，因为是全限名+⽅法名的保存和寻找策略。")])]),t._v(" "),a("p",[t._v("#草稿箱/待整理的学习资料")])])}),[],!1,null,null,null);s.default=e.exports}}]);