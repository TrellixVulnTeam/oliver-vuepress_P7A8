(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{595:function(t,a,e){"use strict";e.r(a);var v=e(17),_=Object(v.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"日志的文件的布局"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志的文件的布局"}},[t._v("#")]),t._v(" 日志的文件的布局")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"title"}),e("p",[e("code",[t._v("kafka")]),t._v(" 中的消息以主题为单位进行分类，在文件存储中 我们将 一个分区 对应 一个日志文件夹，为了防止分区Log 过大，kafka 又引入了 日志分段（LogSegment）即分成多个小的日志文件")])]),e("img",{attrs:{src:t.$withBase("/middleware/kafka/kafka日志文件布局.png"),alt:"foo"}}),t._v(" "),e("h3",{attrs:{id:"日志文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志文件"}},[t._v("#")]),t._v(" 日志文件")]),t._v(" "),e("img",{attrs:{src:t.$withBase("/middleware/kafka/linuxkafka日志分区目录文件.png"),alt:"foo"}}),t._v(" "),e("p",[t._v("日志文件是以： "),e("code",[t._v(".log")]),t._v("  后缀为标识")]),t._v(" "),e("p",[t._v("文件命名是以：一个 64位的长整数标识，每个日志段文件名，都是该段中第一条数据的偏移量（它是一个基准偏移量"),e("strong",[t._v("baseOffset")]),t._v("）")]),t._v(" "),e("p",[t._v("Log的顺序写入机制：所以每次只有一个日志文件可以写入，满足一定条件后欧，将创新新的 日志段文件")]),t._v(" "),e("p",[e("strong",[t._v("日志的分段策略")])]),t._v(" "),e("ul",[e("li",[e("code",[t._v("log.segment.bytes")]),t._v(": 每个日志段的文件最大值，"),e("strong",[t._v("默认为 1G")])]),t._v(" "),e("li",[e("code",[t._v("log.roll.ms")]),t._v("   或 "),e("code",[t._v("log.roll.hours")]),t._v(":  日志段最大的时间戳与当前时间相差的时间。"),e("strong",[t._v("默认为7天")])]),t._v(" "),e("li",[e("code",[t._v("log.index.size.max.bytes")]),t._v("偏移量索引 或 时间戳索引文件超过文件最大值，"),e("strong",[t._v("默认为 10MB")])]),t._v(" "),e("li",[t._v("消息的偏移量 与 当前分段的偏移量之间差值，大于 "),e("code",[t._v("Integer.MAX_VALUE")])])]),t._v(" "),e("h2",{attrs:{id:"索引文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#索引文件"}},[t._v("#")]),t._v(" 索引文件")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"title"}),e("p",[t._v("Kafka 通过两种索引文件，来提高查询消息效率。")]),t._v(" "),e("p",[e("code",[t._v("偏移量索引： 通过消息偏移量建立物理地址映射")]),t._v(" "),e("code",[t._v("时间戳索引： 通过实际戳建立物理地址映射")])])]),e("p",[t._v("Kafka 的并不是把所有的消息offset 或 时间戳 都存储了对应的地址映射")]),t._v(" "),e("p",[t._v("而是 选择了 "),e("code",[t._v("稀疏索引")]),t._v(" 在存储空间 和 查找效率 找了一种折中方式，存储部分的偏移量")]),t._v(" "),e("p",[t._v("如果在索引文件中找不到对应的索引项，则通过获取 小于指定偏移量的最大的偏移量，然后根据该偏移量进行二次定位操作")]),t._v(" "),e("h3",{attrs:{id:"偏移量索引文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#偏移量索引文件"}},[t._v("#")]),t._v(" 偏移量索引文件")]),t._v(" "),e("center",[t._v("索引文件存储数据")]),t._v(" "),e("img",{attrs:{src:t.$withBase("/middleware/kafka/偏移量索引文件.png"),alt:"foo"}}),t._v(" "),e("ul",[e("li",[t._v("relaticeOffset：相对偏移量,表示消息相对于 "),e("code",[t._v("baseOffset")]),t._v(" 的偏移量,占用4个字节,当前索引文件的文件名即为 "),e("code",[t._v("baseOffset")]),t._v("的值")]),t._v(" "),e("li",[t._v("position：具体的物理地址")])]),t._v(" "),e("h3",{attrs:{id:"时间戳索引文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#时间戳索引文件"}},[t._v("#")]),t._v(" 时间戳索引文件")]),t._v(" "),e("center",[t._v("索引文件存储数据")]),t._v(" "),e("img",{attrs:{src:t.$withBase("/middleware/kafka/时间戳偏移量文件.png"),alt:"foo"}}),t._v(" "),e("ul",[e("li",[t._v("Timestamp: 当前日志分段最大的时间戳")]),t._v(" "),e("li",[t._v("relativeOffset: 时间戳所对应的消息的相对偏移量")])]),t._v(" "),e("h2",{attrs:{id:"日志的删除策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#日志的删除策略"}},[t._v("#")]),t._v(" 日志的删除策略")]),t._v(" "),e("ul",[e("li",[t._v("基于时间删除\n"),e("ul",[e("li",[t._v("相关参数："),e("code",[t._v("log.retention.ms")]),t._v("、"),e("code",[t._v("log.retention.hours")]),t._v("、"),e("code",[t._v("log.retention.minutes")])]),t._v(" "),e("li",[t._v("默认参数： 7天")])])]),t._v(" "),e("li",[t._v("基于日志大小删除\n"),e("ul",[e("li",[t._v("相关参数："),e("code",[t._v("log.retention.bytes")])]),t._v(" "),e("li",[t._v("默认为： -1 即无穷大")])])])])],1)}),[],!1,null,null,null);a.default=_.exports}}]);